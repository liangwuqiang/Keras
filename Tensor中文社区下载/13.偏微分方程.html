<!DOCTYPE html>
    <html><head><meta charset="UTF-8">
    </head><body>
    <p><a href="http://www.tensorfly.cn/tfdoc/tutorials/overview.html">原文链接</a></p>
        <section class="normal" id="section-">
<h1 id="偏微分方程-">偏微分方程 <a class="md-anchor" id="AUTOGENERATED-partial-differential-equations"></a></h1>
<p><strong><em>TensorFlow</em></strong> 不仅仅是用来机器学习，它更可以用来模拟仿真。在这里，我们将通过模拟仿真几滴落入一块方形水池的雨点的例子，来引导您如何使用 <strong><em>TensorFlow</em></strong> 中的偏微分方程来模拟仿真的基本使用方法。</p>
<blockquote>
<p>注：本教程最初是准备做为一个 <strong>IPython</strong> 的手册。</p>
<blockquote>
<p>译者注:关于偏微分方程的相关知识，译者推荐读者查看 <a href="http://open.163.com/" target="_blank"><strong>网易公开课</strong></a> 上的<a href="http://open.163.com/special/opencourse/multivariable.html" target="_blank"><strong>《麻省理工学院公开课：多变量微积分》</strong></a>课程。</p>
</blockquote>
</blockquote>
<h2 id="基本设置-">基本设置 <a class="md-anchor" id="AUTOGENERATED-basic-setup"></a></h2>
<p>首先,我们需要导入一些必要的引用。</p>
<pre><code class="lang-python"><span class="hljs-comment">#导入模拟仿真需要的库</span>
<span class="hljs-keyword">import</span> tensorflow <span class="hljs-keyword">as</span> tf
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np

<span class="hljs-comment">#导入可视化需要的库</span>
<span class="hljs-keyword">import</span> PIL.Image
<span class="hljs-keyword">from</span> cStringIO <span class="hljs-keyword">import</span> StringIO
<span class="hljs-keyword">from</span> IPython.display <span class="hljs-keyword">import</span> clear_output, Image, display
</code></pre>
<p>然后，我们还需要一个用于表示池塘表面状态的函数。</p>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">DisplayArray</span><span class="hljs-params">(a, fmt=<span class="hljs-string">&amp;apos;jpeg&amp;apos;</span>, rng=[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>])</span>:</span>
  <span class="hljs-string">"""Display an array as a picture."""</span>
  a = (a - rng[<span class="hljs-number">0</span>])/float(rng[<span class="hljs-number">1</span>] - rng[<span class="hljs-number">0</span>])*<span class="hljs-number">255</span>
  a = np.uint8(np.clip(a, <span class="hljs-number">0</span>, <span class="hljs-number">255</span>))
  f = StringIO()
  PIL.Image.fromarray(a).save(f, fmt)
  display(Image(data=f.getvalue()))
</code></pre>
<p>最后，为了方便演示，这里我们需要打开一个 <strong><em>TensorFlow</em></strong> 的交互会话（interactive session）。当然为了以后能方便调用，我们可以把相关代码写到一个可以执行的<strong><em>Python</em></strong>文件中。</p>
<pre><code class="lang-python">sess = tf.InteractiveSession()
</code></pre>
<h2 id="定义计算函数-">定义计算函数 <a class="md-anchor" id="AUTOGENERATED-computational-convenience-functions"></a></h2>
<pre><code class="lang-python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">make_kernel</span><span class="hljs-params">(a)</span>:</span>
  <span class="hljs-string">"""Transform a 2D array into a convolution kernel"""</span>
  a = np.asarray(a)
  a = a.reshape(list(a.shape) + [<span class="hljs-number">1</span>,<span class="hljs-number">1</span>])
  <span class="hljs-keyword">return</span> tf.constant(a, dtype=<span class="hljs-number">1</span>)

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">simple_conv</span><span class="hljs-params">(x, k)</span>:</span>
  <span class="hljs-string">"""A simplified 2D convolution operation"""</span>
  x = tf.expand_dims(tf.expand_dims(x, <span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)
  y = tf.nn.depthwise_conv2d(x, k, [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>], padding=<span class="hljs-string">&amp;apos;SAME&amp;apos;</span>)
  <span class="hljs-keyword">return</span> y[<span class="hljs-number">0</span>, :, :, <span class="hljs-number">0</span>]

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">laplace</span><span class="hljs-params">(x)</span>:</span>
  <span class="hljs-string">"""Compute the 2D laplacian of an array"""</span>
  laplace_k = make_kernel([[<span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.5</span>],
                           [<span class="hljs-number">1.0</span>, -<span class="hljs-number">6.</span>, <span class="hljs-number">1.0</span>],
                           [<span class="hljs-number">0.5</span>, <span class="hljs-number">1.0</span>, <span class="hljs-number">0.5</span>]])
  <span class="hljs-keyword">return</span> simple_conv(x, laplace_k)
</code></pre>
<h2 id="定义偏微分方程-">定义偏微分方程 <a class="md-anchor" id="AUTOGENERATED-define-the-pde"></a></h2>
<p>首先,我们需要创建一个完美的 500 × 500 的正方形池塘,就像是我们在现实中找到的一样。</p>
<pre><code class="lang-python">N = <span class="hljs-number">500</span>
</code></pre>
<p>然后，我们需要创建了一个池塘和几滴将要坠入池塘的雨滴。</p>
<pre><code class="lang-python"><span class="hljs-comment"># Initial Conditions -- some rain drops hit a pond</span>

<span class="hljs-comment"># Set everything to zero</span>
u_init = np.zeros([N, N], dtype=<span class="hljs-string">"float32"</span>)
ut_init = np.zeros([N, N], dtype=<span class="hljs-string">"float32"</span>)

<span class="hljs-comment"># Some rain drops hit a pond at random points</span>
<span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> range(<span class="hljs-number">40</span>):
  a,b = np.random.randint(<span class="hljs-number">0</span>, N, <span class="hljs-number">2</span>)
  u_init[a,b] = np.random.uniform()

DisplayArray(u_init, rng=[-<span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>])
</code></pre>
<p><img alt="jpeg" src="images/9bb08e1ce4843ee47103428378eda89e.jpg"/></p>
<p>现在，让我们来指定该微分方程的一些详细参数。</p>
<pre><code class="lang-python"><span class="hljs-comment"># Parameters:</span>
<span class="hljs-comment"># eps -- time resolution</span>
<span class="hljs-comment"># damping -- wave damping</span>
eps = tf.placeholder(tf.float32, shape=())
damping = tf.placeholder(tf.float32, shape=())

<span class="hljs-comment"># Create variables for simulation state</span>
U  = tf.Variable(u_init)
Ut = tf.Variable(ut_init)

<span class="hljs-comment"># Discretized PDE update rules</span>
U_ = U + eps * Ut
Ut_ = Ut + eps * (laplace(U) - damping * Ut)

<span class="hljs-comment"># Operation to update the state</span>
step = tf.group(
  U.assign(U_),
  Ut.assign(Ut_))
</code></pre>
<h2 id="开始仿真-">开始仿真 <a class="md-anchor" id="AUTOGENERATED-run-the-simulation"></a></h2>
<p>为了能看清仿真效果，我们可以用一个简单的 <strong>for</strong> 循环来远行我们的仿真程序。</p>
<pre><code class="lang-python"><span class="hljs-comment"># Initialize state to initial conditions</span>
tf.initialize_all_variables().run()

<span class="hljs-comment"># Run 1000 steps of PDE</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1000</span>):
  <span class="hljs-comment"># Step simulation</span>
  step.run({eps: <span class="hljs-number">0.03</span>, damping: <span class="hljs-number">0.04</span>})
  <span class="hljs-comment"># Visualize every 50 steps</span>
  <span class="hljs-keyword">if</span> i % <span class="hljs-number">50</span> == <span class="hljs-number">0</span>:
    clear_output()
    DisplayArray(U.eval(), rng=[-<span class="hljs-number">0.1</span>, <span class="hljs-number">0.1</span>])
</code></pre>
<p><img alt="jpeg" src="images/f2c57add2630d9cbdea2a2877dabd57d.jpg"/></p>
<p>看！！ 雨点落在池塘中,和现实中一样的泛起了涟漪。</p>
<blockquote>
<p>原文链接:<a href="http://tensorflow.org/tutorials/pdes/index.md" target="_blank">http://tensorflow.org/tutorials/pdes/index.md</a>    翻译:<a href="https://github.com/wangaicc" target="_blank">@wangaicc</a>   校对:<a href="https://github.com/tensorfly" target="_blank">@tensorfly</a></p>
</blockquote>
</section>
    </body></html>